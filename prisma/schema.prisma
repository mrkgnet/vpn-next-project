generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  phoneNumber String  @unique
  otpCode     String?
  otpExpires  String?
  userWallet  Int     @default(0)
  role        String  @default("user")
  isActive    Boolean @default(true)

  // رابطه: یک کاربر می‌تواند چندین خرید داشته باشد
  purchases Purchase[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// مدل جدید برای ذخیره جزئیات هر خرید
model Purchase {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  username  String // همان کد دعوت یا نام اکانت (inviteCode)
  gb        Int // حجم خریداری شده
  days      Int // تعداد روز
  price     Int // مبلغی که بابت این اکانت کسر شده
  createdAt DateTime @default(now()) // تاریخ خرید

  // اتصال به کاربر
  user   User   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId
}
